services:
  - type: web
    name: mail-query-mcp-server
    runtime: python
    env: python
    buildCommand: |
      curl -LsSf https://astral.sh/uv/install.sh | sh
      . $HOME/.cargo/env
      uv sync
    startCommand: ./start.sh
    envVars:
      - key: PYTHON_VERSION
        value: 3.12.3

      # Database Configuration
      - key: DATABASE_PATH
        value: ./data/mail_query.db

      # Security
      - key: ENCRYPTION_KEY
        sync: false

      # Application Settings
      - key: LOG_LEVEL
        value: INFO
      - key: LOG_FORMAT
        value: json
      - key: ENVIRONMENT
        value: production
      - key: BATCH_SIZE
        value: 20
      - key: TOKEN_REFRESH_BUFFER_MINUTES
        value: 10

      # Mail Processing Settings
      - key: ENABLE_MAIL_HISTORY
        value: true
      - key: MAX_KEYWORDS_PER_MAIL
        value: 5
      - key: MAX_MAILS_PER_ACCOUNT
        value: 200

      # Mail Filter Settings
      - key: ENABLE_MAIL_FILTERING
        value: true
      - key: ENABLE_SUSPICIOUS_SENDER_CHECK
        value: true
      - key: BLOCKED_DOMAINS
        value: noreply.com,no-reply.com,donotreply.com
      - key: BLOCKED_KEYWORDS
        value: newsletter,promotion,marketing
      - key: BLOCKED_SENDER_PATTERNS
        value: noreply@,no-reply@,donotreply@
